{% extends 'main/loggedIn.html'%}

{% block head %} 
<link rel="stylesheet" href="{{url_for('static',filename='css/search.css')}}"> 
<script src ="../../static/js/functions.js"> </script>

{% endblock %}

{% block content %}
<div class = "searchbar">
	<input id="bar" type="text" placeholder="Search ..."> 
	<select name="filters" id="filters">
		<option value="username">Username</option>
		<option value="country">Country</option>
		<option value="location">Location</option>
	</select>
</div>

<ul id="search-results"> 
		<li> </li>
		<li> </li>
		<li>a </li>
		<li> </li>
		<li> </li>
		<li> </li>
		<li> </li>
		<li> </li>
		<li> </li>
		<li> </li>
	</ul>




<div class = "admin-panel"> 
	<button id="get-users" onclick="getResults()"> Get all Users </button>
	<a href="{{url_for('routes.getUsers')}}">See users</a> 
</div> 


<script> 
	function test1(SQL_result) {
		retVal=SQL_result.split("),");
		return retVal;
	}
	
	function updateList(names) { 
		let html_list = document.querySelectorAll('#search-results li');
		console.log(html_list);
		for (let i = 0; i < names.length; i++) {
			html_list[i].innerText = names[i];
		}
	}
	
	function getResults() {

		let searchTerm = document.getElementById("bar").value; 
		let filter = document.getElementById("filters").value;

		query = "SELECT " + filter + " FROM Users where " +
				filter + " LIKE \'" + searchTerm + "%\';";

		fetch ('/getSearchTerm', {
			headers : {
				'Content-Type': 'application/json'
			},
			method:'POST',
			body: JSON.stringify({
				"search_term":searchTerm,
				"filter":filter,
				"query":query
			})
		}).then(function(response) { 
			return response.text();
		}).then(function(text) {
			console.log(searchTerm);
			console.log(filter);
			console.log(query);
			console.log('POST RESPONSE: ');
			console.log(text);
			console.log("In array form: \n");
			names = JSON.parse(text);
			console.log(names); 
			updateList(names);
		})
	}
</script> 
{% endblock %} 

